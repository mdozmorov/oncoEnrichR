### TCGA aberration frequency

#### SNVs/InDels {.tabset}

```{r tcga_oncoplot_setup, echo = F, eval = T}

tcga_oncoplot_data <- onc_rep[["data"]][["tcga"]][["aberration"]][["table"]][["snv_indel"]]

```


##### Breast

```{r tcga_oncoplot_breast, echo = F, eval = T, fig.height = 15, fig.width = 14.5}

code <- tcga_oncoplot_data[["Breast"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Breast"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F, gene_mar = 6,
                   annotationFontSize = 1.4, sepwd_genes = 0.7, fontSize = 1.2,
                   legendFontSize = 1.6, legend_height = 6)
```

##### Colon/Rectum

```{r tcga_oncoplot_colon, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Colon/Rectum"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Colon/Rectum"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis","MSI_status"), showTitle = F)
```

##### Lung

```{r tcga_oncoplot_lung, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Lung"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Lung"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```

##### Skin

```{r tcga_oncoplot_skin, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Skin"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Skin"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```

##### Esophagus/Stomach

```{r tcga_oncoplot_stomach, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Esophagus/Stomach"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Esophagus/Stomach"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis","MSI_status"), showTitle = F)
```

##### Cervix

```{r tcga_oncoplot_cervix, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Cervix"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Cervix"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```

##### Prostate

```{r tcga_oncoplot_prostate, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Prostate"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Prostate"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```

##### Ovary/Fallopian Tube

```{r tcga_oncoplot_ovary, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Ovary/Fallopian Tube"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Ovary/Fallopian Tube"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```


##### Uterus


```{r tcga_oncoplot_uterus, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Uterus"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Uterus"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis","MSI_status"), showTitle = F)
```


##### Pancreas


```{r tcga_oncoplot_pancreas, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Pancreas"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Pancreas"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```


##### Soft Tissue


```{r tcga_oncoplot_softtissue, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Soft Tissue"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Soft Tissue"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```

##### Myeloid


```{r tcga_oncoplot_myeloid, echo = F, eval = T, fig.height = 13, fig.width = 13.5}

code <- tcga_oncoplot_data[["Myeloid"]][['code']]
maf <- readRDS(url(paste0("https://github.com/sigven/oncoEnrichR/raw/master/maf/",code,".maf.rds")))
maftools::oncoplot(maf, genes = tcga_oncoplot_data[["Myeloid"]][['top_mutated_genes']]$symbol,
                     drawRowBar = F, drawColBar = F,
                     sortByAnnotation = T,
                     clinicalFeatures = c("Diagnosis"), showTitle = F)
```


<br><br>

#### Copy number alterations

* The somatic mutation frequencies of the target genes in ~10,000 tumor samples have been calculated
* Gene aberration frequency are plotted across two categories of mutation types
    1. sCNA - amplifications
    2. sCNA - homozygous deletions
* Frequency is plotted pr. primary site as 
  * *_percent_mutated_* (percent of all tumor samples with the gene mutated)
* Frequencies across all subtypes are listed in an interactive table


<br><br>
```{r tcga_ampl_plot, echo = F, eval = T, fig.height = onc_enrich_report[['config']][['tcga_aberration']][['plot_height']], fig.width = 13.5}
onc_enrich_report[['data']][['tcga']][['aberration']][['plot']][['cna_ampl']]

```
<br><br>
```{r tcga_homdel_plot, echo = F, eval = T, fig.height = onc_enrich_report[['config']][['tcga_aberration']][['plot_height']], fig.width = 13.5}
onc_enrich_report[['data']][['tcga']][['aberration']][['plot']][['cna_homdel']]

```
<br><br>




```{r filter_tcga, echo=F, results='asis'}

show_tcga_freqs <- FALSE
missing_tcga_freqs <- TRUE
all_targets_vtypes <- dplyr::bind_rows(onc_enrich_report[['data']][['tcga']][['aberration']][['table']][['cna_homdel']],
                                       onc_enrich_report[['data']][['tcga']][['aberration']][['table']][['cna_ampl']])

if(nrow(all_targets_vtypes) > 0){
  show_tcga_freqs <- TRUE
  missing_tcga_freqs <- FALSE
}

```


```{r table_browse_tcga_freqs, echo=F, results = "asis", eval = show_tcga_freqs}
library(crosstalk)

all_targets_vtypes <- dplyr::bind_rows(onc_enrich_report[['data']][['tcga']][['aberration']][['table']][['cna_homdel']],
                                       onc_enrich_report[['data']][['tcga']][['aberration']][['table']][['cna_ampl']]) %>%
  dplyr::arrange(desc(percent_mutated))
targets_tcga <- crosstalk::SharedData$new(all_targets_vtypes)

crosstalk::bscols(
  list(
    crosstalk::filter_select("primary_site", "Primary site/tissue", targets_tcga, ~primary_site),
    crosstalk::filter_select("variant_type", "Aberration type", targets_tcga, ~variant_type),
    crosstalk::filter_slider("percent_mutated", "Percent mutated", targets_tcga, ~percent_mutated)
  ),
  list(
    crosstalk::filter_select("primary_diagnosis", "Diagnosis", targets_tcga, ~primary_diagnosis),
    crosstalk::filter_slider("cohort_size", "Cohort Size", targets_tcga, ~cohort_size)
  )
)

htmltools::br()
crosstalk::bscols(
  DT::datatable(targets_tcga, escape = F, extensions=c("Buttons","Responsive"), width = "100%",
    options=list(buttons = c('csv','excel'),dom = 'Bfrtip'))
      # DT::formatStyle('percent_mutated',
      #                 background = DT::styleColorBar(targets_tcga$percent_mutated, 'steelblue', angle = -90),
      #                 backgroundSize = '100% 90% 80% 70% 60% 50% 40% 30% 20% 10% 0%',
      #                 backgroundRepeat = 'no-repeat',
      #                 backgroundPosition = 'center')
)

```


```{r tcga_freqs_missing, echo=F, results = 'asis', eval = missing_tcga_freqs}
cat('<i>No genes with tcga aberrations were found.</i>',sep='\n')
cat('\n')
```

<br><br>
